## version: $Id$
<!-- chef_resources_cwiz_finish.vm, use with org.sakaiproject.tool.content.ResourcesAction.java -->
#macro (custom_dateselectionwidget $yearselect_id $monthselect_id $dayselect_id $earliestYear $latestYear $yearSelected $monthSelected $daySelected $onChangeAction)
	#set($yearList = [$earliestYear .. $latestYear])
    <select name="$monthselect_id" id="$monthselect_id" onchange="blur(); $onChangeAction">  
      #if ($monthSelected == 1) <option value="1" selected="selected">$tlang.getString("month.jan")</option> #else <option value="1">$tlang.getString("month.jan")</option> #end
 		#if ($monthSelected == 2) <option value="2" selected="selected">$tlang.getString("month.feb")</option> #else <option value="2">$tlang.getString("month.feb")</option> #end
		#if ($monthSelected == 3) <option value="3" selected="selected">$tlang.getString("month.mar")</option> #else <option value="3">$tlang.getString("month.mar")</option> #end
		#if ($monthSelected == 4) <option value="4" selected="selected">$tlang.getString("month.apr")</option> #else <option value="4">$tlang.getString("month.apr")</option> #end
		#if ($monthSelected == 5) <option value="5" selected="selected">$tlang.getString("month.may")</option> #else <option value="5">$tlang.getString("month.may")</option> #end
		#if ($monthSelected == 6) <option value="6" selected="selected">$tlang.getString("month.jun")</option> #else <option value="6">$tlang.getString("month.jun")</option> #end
		#if ($monthSelected == 7) <option value="7" selected="selected">$tlang.getString("month.jul")</option> #else <option value="7">$tlang.getString("month.jul")</option> #end
		#if ($monthSelected == 8) <option value="8" selected="selected">$tlang.getString("month.aug")</option> #else <option value="8">$tlang.getString("month.aug")</option> #end
		#if ($monthSelected == 9) <option value="9" selected="selected">$tlang.getString("month.sep")</option> #else <option value="9">$tlang.getString("month.sep")</option> #end
		#if ($monthSelected == 10) <option value="10" selected="selected">$tlang.getString("month.oct")</option> #else <option value="10">$tlang.getString("month.oct")</option> #end
		#if ($monthSelected == 11) <option value="11" selected="selected">$tlang.getString("month.nov")</option> #else <option value="11">$tlang.getString("month.nov")</option> #end
		#if ($monthSelected == 12) <option value="12" selected="selected">$tlang.getString("month.dec")</option> #else <option value="12">$tlang.getString("month.dec")</option> #end
    </select>
    <select name="$dayselect_id" id="$dayselect_id" onchange="blur(); $onChangeAction">
	    #foreach($d in [1..31])
	        #if($d == $daySelected)
	            <option value="$d" selected="selected">$d</option>
	        #else
	            <option value="$d">$d</option>
	        #end
		#end
    </select>
    <select name="$yearselect_id" id="$yearselect_id" onchange="blur(); $onChangeAction">
        #foreach ($y in $yearList)
            #if ($y == $yearSelected)
                    <option value="$y" selected="selected">$y</option>
            #else
                    <option value="$y">$y</option>
            #end
		#end
    </select>
	#chef_dateselectionwidgetpopup($yearselect_id $monthselect_id $dayselect_id)
#end

#macro(custom_timeSelectionWidget $prefix $current_value $onChangeAction)
			#set($time = $current_value.toStringLocalFull())
			#set($hour = $current_value.breakdownLocal().hour)
			#set($minute = $current_value.breakdownLocal().min)
			
			#if($hour > 12)
				#set($hour = $hour - 12)
				#set($timeType = "pm")
			#elseif ($hour == 0)
				#set($hour = 12)
				#set($timeType = "am")
			#end
			
			<select name="${prefix}_hour" id="${prefix}_hour" onchange="hourChange('${prefix}_hour'); $!onChangeAction return false;">
				#if($hour == 1) <option selected="selected" value="1">1</option> #else <option value="1">1</option> #end
				#if($hour == 2) <option selected="selected" value="2">2</option> #else <option value="2">2</option> #end
				#if($hour == 3) <option selected="selected" value="3">3</option> #else <option value="3">3</option> #end
				#if($hour == 4) <option selected="selected" value="4">4</option> #else <option value="4">4</option> #end
				#if($hour == 5) <option selected="selected" value="5">5</option> #else <option value="5">5</option> #end
				#if($hour == 6) <option selected="selected" value="6">6</option> #else <option value="6">6</option> #end 
				#if($hour == 7) <option selected="selected" value="7">7</option> #else <option value="7">7</option> #end
				#if($hour == 8) <option selected="selected" value="8">8</option> #else <option value="8">8</option> #end
				#if($hour == 9) <option selected="selected" value="9">9</option> #else <option value="9">9</option> #end
				#if($hour == 10) <option selected="selected" value="10">10</option> #else <option value="10">10</option> #end
				#if($hour == 11) <option selected="selected" value="11">11</option> #else <option value="11">11</option> #end
				#if($hour == 12) <option selected="selected" value="12">12</option> #else <option value="12">12</option> #end
			</select>
			
			<select name="${prefix}_minute" id="${prefix}_minute" onchange="hourChange('${prefix}_minute'); $!onChangeAction return false;">
				#if($minute == 0) <option selected="selected" value="0">00</option> #else <option value="0">00</option> #end
				#if($minute == 5) <option selected="selected" value="5">05</option> #else <option value="5">05</option> #end
				#if($minute == 10) <option selected="selected" value="10">10</option> #else <option value="10">10</option> #end
				#if($minute == 15) <option selected="selected" value="15">15</option> #else <option value="15">15</option> #end
				#if($minute == 20) <option selected="selected" value="20">20</option> #else <option value="20">20</option> #end
				#if($minute == 25) <option selected="selected" value="25">25</option> #else <option value="25">25</option> #end
				#if($minute == 30) <option selected="selected" value="30">30</option> #else <option value="30">30</option> #end 
				#if($minute == 35) <option selected="selected" value="35">35</option> #else <option value="35">35</option> #end
				#if($minute == 40) <option selected="selected" value="40">40</option> #else <option value="40">40</option> #end
				#if($minute == 45) <option selected="selected" value="45">45</option> #else <option value="45">45</option> #end
				#if($minute == 50) <option selected="selected" value="50">50</option> #else <option value="50">50</option> #end
				#if($minute == 55) <option selected="selected" value="55">55</option> #else <option value="55">55</option> #end
			</select>
		 
			<select name="${prefix}_ampm" id="${prefix}_ampm" onchange="ampmChange('${prefix}_ampm'); $!onChangeAction return false;">
				#if($timeType =="am") <option selected="selected">am</option> #else <option>am</option> #end
				#if($timeType =="pm") <option selected="selected">pm</option> #else <option>pm</option> #end
			</select>
#end
##
<div class="portletBody">
	<h3>
		$title 
	</h3>
	#if ($alertMessage)<div class="alertMessage">$tlang.getString("label.alert") $validator.escapeHtml($alertMessage)</div>#end
	<p class="instruction">
		$instruction
		$required
	</p>
	
	<form name="propertyForm" id="propertyForm" action="#toolLinkParam("ResourcesAction" "doCompleteCreateWizard" "flow=update")" method="post">
		<input type="hidden" name="sakai_action" id="sakai_action" value="doCompleteCreateWizard" />
		<input type="hidden" name="user_action" id="user_action" value="save" />
		<p class="shorttext">
			<span class="reqStar">*</span>
			<label for="name">
				$tlang.getString("title.name") 
			</label>
			<input type="text" size="40" id="name" name="name" value="$validator.escapeHtml("$!item.name")" />
		</p>
		#if($type.hasDescription())
			<p class="shorttext">
				<label for="description">
					$tlang.getString("title.description")
				</label>
				<textarea id="description" name="description" rows="2" cols="40" wrap="virtual">$validator.escapeHtmlTextarea("$!item.description")</textarea>
			</p>
		#end	
		#if($type.hasRightsDialog()) 
			#if ($!copyrightTypes)
				<p class="shorttext">
					<span class="reqStar">*</span>
					<label for="copyright">
						$tlang.getString("cright.status")
					</label>	
					<select name="copyright" id ="copyright" onchange="javascript:updateCopyright(this);">
						#foreach ($copyright in $copyrightTypes)
							<option value="$copyright"#if($item.copyrightStatus == $copyright) selected="selected"#end>$copyright</option>
						#end
					</select>
					#if ($!fairuseurl)
						(<a href="$fairuseurl" target="_blank" title="[$tlang.getString('cright.newwin')]"><span class="skip"> [$tlang.getString('cright.newwin')]</span>$tlang.getString("cright.fairuse")</a>)
					#end
				</p>
				<div id="copyright_status">
					#if($item.copyrightStatus == $USE_THIS_COPYRIGHT)
						<p class="shorttext">
							<span class="reqStar">*</span>
							<label for="newcopyright">
								$tlang.getString("cright.info")
							</label>	
							<textarea name="newcopyright" id="newcopyright" rows="2" cols="40" wrap="virtual" >$validator.escapeHtmlTextarea("$!item.copyrightInfo")</textarea>
						</p>	
					#else
						<input type="hidden" name="newcopyright" id="newcopyright" value="$!item.copyrightInfo" />
					#end
				</div>
				<table border="0">
					<tr>
						<td style="width:180px;padding-left:1em;vertical-align:top">
							<label for="copyrightAlert">
								$tlang.getString("cright.alert")
							</label>
						</td>
						<td style="vertical-align:top">
							<input type="checkbox" name="copyrightAlert" id ="copyrightAlert" value="true" #if($item.hasCopyrightAlert())checked="checked"#end style="border:none" />
							$tlang.getString("cright.display")
							(<a href="#" onclick="javascript:openSampleCopyrightWindow();"   title="[$tlang.getString('cright.newwin')]"><span class="skip">[$tlang.getString('cright.newwin')]</span>$tlang.getString("cright.show")</a>)
						</td>
					</tr>
				</table>
			#end
		#end
		
		######### begin availability section ##########
		#if($availability_is_enabled && $type.hasAvailabilityDialog() && !$item.isInWorkspace() && !$dropboxMode)
			<h4>$tlang.getString("title.availability")</h4>
			<div  class="labelindnt">
				<table>
					<tr>
						<td>
							<input type="radio" name="hidden" id="hidden_false" value="false" #if(!$item.isHidden())checked="checked" #end/>
						</td>
						<td colspan="4">
							<label for="hidden_false">
								$tlang.getString("avail.show")
							</label>
						</td>
					</tr>
					<tr>
						<td>
						</td>
						<td>
							<input type="checkbox" name="use_start_date" id="use_start_date" value="true" #if($item.useReleaseDate())checked="checked" #end/>
						</td>
						<td colspan="3">
							<label for="use_start_date">
								$tlang.getString("avail.start")
							</label>
						</td>
					</tr>
					<tr>
						<td>
						</td>
						<td>
						</td>
						<td>
						</td>
						<td>
							<label for="release_year">Date:</label>
						</td>
						<td>
							<label for="release_hour">Time:</label>
						</td>
					</tr>
					#set($yearX = $item.releaseDate.breakdownLocal().year)
					#set($year0 = $yearX - 4)
					#set($yearN = $yearX + 4)
					#set($monthX = $item.releaseDate.breakdownLocal().month)
					#set($dayX = $item.releaseDate.breakdownLocal().day)
					<tr>
						<td>
						</td>
						<td>
						</td>
						<td>
						</td>
						<td>
							#custom_dateselectionwidget("release_year" "release_month" "release_day" $year0 $yearN $yearX $monthX $dayX "document.getElementById('hidden_true').checked=false;document.getElementById('hidden_false').checked=true;document.getElementById('use_start_date').checked=true;")
						</td>
						<td>
							#custom_timeSelectionWidget("release" $item.releaseDate "document.getElementById('hidden_true').checked=false;document.getElementById('hidden_false').checked=true;document.getElementById('use_start_date').checked=true;")
						</td>
					</tr>
					<tr>
						<td>
						</td>
						<td>
							<input type="checkbox" name="use_end_date" id="use_end_date" value="true" #if($item.useRetractDate())checked="checked" #end/>
						</td>
						<td colspan="4">
							<label for="use_end_date">
								$tlang.getString("avail.end")
							</label>
						</td>
					</tr>
					<tr>
						<td>
						</td>
						<td>
						</td>
						<td>
						</td>
						<td>
							<label for="retract_year">Date:</label>
						</td>
						<td>
							<label for="retract_time">Time:</label>
						</td>
					</tr>
					#set($yearX = $item.retractDate.breakdownLocal().year)
					#set($year0 = $yearX - 4)
					#set($yearN = $yearX + 4)
					#set($monthX = $item.retractDate.breakdownLocal().month)
					#set($dayX = $item.retractDate.breakdownLocal().day)
					<tr>
						<td>
						</td>
						<td>
						</td>
						<td>
						</td>
						<td>
							#custom_dateselectionwidget("retract_year" "retract_month" "retract_day" $year0 $yearN $yearX $monthX $dayX "document.getElementById('hidden_true$i').checked=false;document.getElementById('hidden_false$i').checked=true;document.getElementById('use_end_date$i').checked=true;")
						</td>
						<td>
							#custom_timeSelectionWidget("retract" $item.retractDate "document.getElementById('hidden_true$i').checked=false;document.getElementById('hidden_false$i').checked=true;document.getElementById('use_end_date$i').checked=true;")
						</td>
					</tr>
					<tr>
						<td>
							<input type="radio" name="hidden" id="hidden_true" value="true" #if($item.isHidden())checked="checked" #end/>
						</td>
						<td colspan="4">
							<label for="hidden_true">
								$tlang.getString("avail.hide")
							</label>
						</td>
					</tr>
				</table>
			</div>
		#end
		######### end availability section ##########
		
		######### begin access section ##########
		## Should initial access to this resource or collection be determined
		## for "site" (standard sakai permissions), "grouped" or "public"?
		## do not show any access options if in dropbox
		#if($type.hasGroupsDialog() && !$dropboxMode)
			#set ($listDisplay="none")
			## show access options only if public view is allowed or there are groups in the site
			#if($item.isPubviewInherited())
				<h4>$tlang.getString("access.title2")</h4>
				<input type="hidden" name="access_mode" id="access_mode_hidden" value="$INHERITED_ACCESS" />
			#elseif($item.isSingleGroupInherited())
				<h4>$item.singleGroupTitle</h4>
				<input type="hidden" name="access_mode" id="access_mode_hidden" value="$INHERITED_ACCESS" />
			#elseif($item.isSiteOnly())
				<h4>$tlang.getString("access.title3")</h4>
				<input type="hidden" name="access_mode" id="access_mode_hidden" value="$INHERITED_ACCESS" />
			#elseif(!$item.isSitePossible())
				<h4>$tlang.getString("access.title5")</h4>
				#set ($listDisplay="block")
			#else
				<h4>$tlang.getString("access.title1")</h4>
				<div  class="labelindnt">
					#if($item.isPubviewPossible())
						<p class="checkbox">
							<input type="radio" name="access_mode" id="access_mode_public" value="public" #if($!item.isPubview()) checked="checked"#end  style="border:none" onclick="javascript:document.getElementById('groupTable').style.display='none';"  />
							<label for="access_mode_public">$tlang.getString("access.title2")</label>
						</p>
					#end
					<p class="checkbox">
						<input type="radio" name="access_mode" id="access_mode_$INHERITED_ACCESS" value="$INHERITED_ACCESS" #if(!$item.isPubview() && ("$!item.access" == "$SITE_ACCESS" || "$!item.access" == "$INHERITED_ACCESS")) checked="checked"#end  style="border:none" onclick="javascript:document.getElementById('groupTable').style.display='none';"  />
						<label for="access_mode_site">$tlang.getString("access.title3")</label>
					</p>
					
					#if($item.isGroupPossible())
						#if($!item.accessMode == $GROUP_ACCESS)
							#set ($listDisplay="block")
						#else
							#set ($listDisplay="none")
						#end
						<p class="checkbox">
							<input type="radio" name="access_mode" id="access_mode_$GROUP_ACCESS" value="$GROUP_ACCESS" #if("$!item.access" == "$GROUP_ACCESS") checked="checked"#end  style="border:none" onclick="javascript:document.getElementById('groupTable').style.display='block';"  />
							<label for="access_mode_$GROUP_ACCESS">$tlang.getString("access.title5")</label>
						</p>
					#end
				</div>
			#end
			#if($item.isGroupPossible())
				<table id="groupTable" class="listHier lines labelindnt" border="0" style="width:80%;display:$listDisplay" cellspacing="0" summary="$tlang.getString("access.group3")">
					<caption class="skip" style="display:none">$tlang.getString("access.title5")</caption>
					<tr>
						<th id="selectAllGroups" style="width:2em;padding-left:.4em">
							<input type="checkbox" id="selectall" title="toggle select all" onclick="javascript:toggleSelectAll(this, 'access_groups')"  />
						</th>
						<th id="groupname">
							$tlang.getString("access.group1")
						</th>
						<th id="groupdescription">
							$tlang.getString("access.group2")
						</th>
					</tr>
					#set($theGroups = $item.possibleGroups)
					#foreach ($group in $!{theGroups})
						#if($item.isPossible($group))
							<tr>
								<td headers="selected" style="padding-bottom:0;" style="width:2em">
									#if($item.allowedRemove($group))
										<input type="checkbox" name="access_groups" id="access_groups_$group.Id" title="$group.title" value="$group.Id" #if($item.isLocal($group) || $item.isGroupInherited()) checked="checked"#end />
									#else
										<img src="#imageLink("sakai/checkon.gif")" border="0" width="17" height="13" align="top" />
									#end
								</td>
								<td headers="name" style="padding-bottom:0;" class="checkbox">
									<label for="access_groups_$group.Id">
										$group.Title
									</label>	
								</td>
								<td headers="description" width="100%"> ##mozilla does not resize table children dynamically , so set here
									#set($description = "")
									#if($group.Description)
										#set($description = $group.Description)
									#end
									$!description
								</td>
							</tr>
						#end
					#end
				</table>
			#end
		#end
		########## end access section ###########
	
		#if (!$dropboxMode)
			#if ($type.hasNotificationDialog())
				#if ($notification)
					<p class="shorttext">
						<label for="notify">
							$tlang.getString("gen.email1")
						</label>	
						<select name="notify" id="notify">
							<option value="r">$tlang.getString("gen.email2")</option>
							<option value="o">$tlang.getString("gen.email3")</option>
							<option value="n" selected="selected">$tlang.getString("gen.email4")</option>
						</select>
					</p>	
				#end
			#end
		#end
		
	
		<p class="act">
			<input type="button" class="active" id="finish_button" onclick="document.getElementById('user_action').value='save';submitform('propertyForm');" value="$tlang.getString("label.finish")" accesskey="s" />
			<input type="button" id="cancel_button" onclick="javascript:document.getElementById('user_action').value='cancel';submitform('propertyForm');" value="$tlang.getString("label.cancel")" accesskey="x" />
		</p>
		
	</form>
</div>
<script language="JavaScript" type="text/javascript">
	<!--
	function submitform(id)
	{
		var theForm = document.getElementById(id);
		if(theForm && theForm.onsubmit)
		{
			theForm.onsubmit();
		}
		if(theForm && theForm.submit)
		{
			theForm.submit();
		}
	}
	function openSampleCopyrightWindow() 
	{ 
	  window.open("$copyright_alert_url","SampleCopyrightAlert","scrollbars=no,menubar=no,height=400,width=700,resizable=no,toolbar=no,location=no,status=no");
	  return false;
	}
	function enableNewCopyright(obj_mycopyright, obj_newcopyright)
	{
		obj_mycopyright.checked = false;
		obj_newcopyright.checked = true;
	}

	function clearNewCopyright(obj_textarea)
	{
		obj_textarea.value = "";
	}
	
	function checkItem(copyrightIndex)
	{
		var obj_alert_name="copyrightAlert";
		var obj_alert_item=document.getElementById(obj_alert_name);
		var obj_newcopyright_name="newcopyright";
		var obj_newcopyright_item=document.getElementById(obj_newcopyright_name);
		if (copyrightIndex == 0)
		{
			obj_alert_item.checked=false;
			obj_newcopyright_item.disabled=true;
		}
		else if (copyrightIndex < 5)
		{
			obj_alert_item.checked=true;
			obj_newcopyright_item.disabled=true;
		}
		else if (copyrightIndex == 5)
		{
			obj_alert_item.checked=true;
			obj_newcopyright_item.disabled=false;
		}
	}
	function updateCopyright(element)
	{
		var cr_div = document.getElementById("copyright_status");
		var new_value = element.value;
		var cr_element = document.getElementById("newcopyright");
		var cr_value = cr_element.value;
		
		var inner_html = "";
		if(new_value == "$USE_THIS_COPYRIGHT")
		{
			inner_html = "<p class=\"shorttext\">\n<span class=\"reqStar\">*</span>\n" 
						+ "<label for=\"newcopyright\">\n$tlang.getString("cright.info")\n</label>\n"
						+ "<textarea name=\"newcopyright\" id=\"newcopyright\" rows=\"2\" cols=\"40\" wrap=\"virtual\" ></textarea>\n</p>\n";	
		}
		else
		{
			inner_html = "<input type=\"hidden\" name=\"newcopyright\" id=\"newcopyright\" value=\"\" />";
		}
		cr_div.innerHTML = inner_html;
		setMainFrameHeight('$validator.escapeJavascript("Main$pid")');	
		cr_element = document.getElementById("newcopyright");
		cr_element.value = cr_value;
		if(new_value == "$USE_THIS_COPYRIGHT")
		{
			cr_element.select();
			cr_element.focus();
		}
	}
	function checkForFile(elementId)
	{
		var element = document.getElementById(elementId);
		var check = document.getElementById("check_" + elementId);
		if(element && element.value && element.value != "" && check)
		{
			check.value = "true";
		}
		else if(check)
		{
			check.value = "false";
		}
	}
	

	function toggleSelectAll(element, item_name)
	{
		var checkboxes = document.getElementsByName(item_name);
		for(var i = 0; i < checkboxes.length; i++)
		{
			if(element.checked)
			{
				checkboxes[i].checked = true;
			}
			else
			{
				checkboxes[i].checked = false;
			}
		}
	}
	-->
</script>


